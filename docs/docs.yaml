openapi: 3.1.0
info:
  title: OCTOPUS
  description: |-
    OCTOPUS is a simple app to manage your applications from Docker and other environments.
  termsOfService: https://swagger.io/terms/
  contact:
    email: adikurek11@gmail.com
  license:
    name: MIT
  version: 1.0.0

servers:
  - url: /api/v1

tags:
  - name: auth
    description: Everything about authentication, login and registering
  - name: app
    description: All operations related to applications
  - name: server
    description: Server metrics and resource data
  - name: docker
    description: Operations on Docker containers
  - name: websocket
    description: WebSocket operations
  - name: user
    description: Operations related to users

paths:
  /apps/{appId}/logs:
    get:
      tags:
        - websocket
      summary: Stream live logs of an app
      description: Establish a WebSocket connection to stream live logs for the specified app.
      operationId: liveLogsApp
      parameters:
        - name: appId
          in: path
          description: The ID of the app
          required: true
          schema:
            type: string
      servers:
        - url: /ws/v1
      responses:
        '101':
          description: WebSocket protocol upgrade (Switching Protocols)
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /apps/docker/import:
    post:
      security:
        - bearerAuth: []
      tags:
        - docker
      summary: Import applications from Docker
      description: Import applications available in Docker into the system.
      operationId: dockerImportApp
      responses:
        '201':
          description: Applications imported successfully
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /apps:
    post:
      security:
        - bearerAuth: []
      tags:
        - app
      summary: Create a new app
      description: Create a new application.
      operationId: createApp
      requestBody:
        description: Create app object
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateApp'
      responses:
        '201':
          description: Application created successfully
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    get:
      security:
        - bearerAuth: []
      tags:
        - app
      summary: Shows all users apps
      description: Shows all users apps.
      operationId: getApps
      responses:
        '200':
          description: Applications downloaded successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetApps"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /apps/{appId}:
    put:
      security:
        - bearerAuth: []
      tags:
        - app
      summary: Update an app
      description: Update an existing application.
      operationId: updateApp
      parameters:
        - name: appId
          in: path
          description: The ID of the app
          required: true
          schema:
            type: string
      requestBody:
        description: Update app object
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateApp'
      responses:
        '204':
          description: App updated successfully
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    get:
      security:
        - bearerAuth: []
      tags:
        - app
      summary: Get an app
      description: Get an existing application.
      operationId: getApp
      parameters:
        - name: appId
          in: path
          description: The ID of the app
          required: true
          schema:
            type: string
      responses:
        '200':
          description: App downloaded successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetApp"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      security:
        - bearerAuth: []
      tags:
        - app
      summary: Delete an app
      description: Delete an existing application.
      operationId: deleteApp
      parameters:
        - name: appId
          in: path
          description: The ID of the app
          required: true
          schema:
            type: string
      responses:
        '204':
          description: App deleted successfully
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /apps/{appId}/status:
    get:
      security:
        - bearerAuth: []
      tags:
        - app
      summary: Get status of an app
      description: Retrieve the current status of an application.
      operationId: statusApp
      parameters:
        - name: appId
          in: path
          description: The ID of the app
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Status retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusApp"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /auth/register:
    post:
      tags:
        - auth
      summary: Register a new user
      description: Register a new user account.
      operationId: registerUser
      requestBody:
        description: Create user object
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUser'
      responses:
        '201':
          description: User registered successfully
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /auth/login:
    post:
      tags:
        - auth
      summary: User login
      description: Authenticate a user and return a token.
      operationId: loginUser
      requestBody:
        description: Login user object
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginUser'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Token'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /auth/check:
    get:
      security:
        - bearerAuth: []
      tags:
        - auth
      summary: Check if user is logged in
      description: Verify if the current user session is valid.
      operationId: loginCheckUser
      responses:
        '204':
          description: User is logged in
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VerifyUser"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /auth/logout:
    delete:
      security:
        - bearerAuth: []
      tags:
        - auth
      summary: Log out a user
      description: Invalidate the current user session.
      operationId: logoutUser
      responses:
        '204':
          description: User logged out successfully
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /server/metrics:
    get:
      security:
        - bearerAuth: []
      tags:
        - server
      summary: Get server metrics
      description: Retrieve information about server resource usage.
      operationId: serverMetrics
      responses:
        '200':
          description: Server metrics retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerMetrics"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /server:
    get:
      security:
        - bearerAuth: []
      tags:
        - server
      summary: Get info about the server
      description: Retrieve information about server.
      operationId: serverInfo
      responses:
        '200':
          description: Server informations retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerInfo"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /users/{userId}:
    put:
      security:
        - bearerAuth: []
      tags:
        - user
      summary: Update user
      description: Update a user’s account information.
      operationId: updateUser
      parameters:
        - name: userId
          in: path
          description: The ID of the user
          required: true
          schema:
            type: string
      requestBody:
        description: Updated user object
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUser'
      responses:
        '204':
          description: User updated successfully
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    get:
      security:
        - bearerAuth: []
      tags:
        - user
      summary: Get user
      description: Get a user’s account information.
      operationId: getUser
      parameters:
        - name: userId
          in: path
          description: The ID of the user
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Users data downloaded successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetUser"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    patch:
      security:
        - bearerAuth: []
      tags:
        - user
      summary: Change user password
      description: Change the password for a specific user.
      operationId: changeUserPassword
      parameters:
        - name: userId
          in: path
          description: The ID of the user
          required: true
          schema:
            type: string
      requestBody:
        description: Password change object
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                currentPassword:
                  type: string
                newPassword:
                  type: string
                confirmPassword:
                  type: string
              required:
                - currentPassword
                - newPassword
                - confirmPassword
      responses:
        '204':
          description: Password changed successfully
        '400':
          description: Invalid username or password supplied
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      security:
        - bearerAuth: []
      tags:
        - user
      summary: Delete a user
      description: Delete a user account. This can only be done by the logged-in user.
      operationId: deleteUser
      parameters:
        - name: userId
          in: path
          description: The ID of the user
          required: true
          schema:
            type: string
      responses:
        '204':
          description: User deleted successfully
        '400':
          description: Invalid userId supplied
        '404':
          description: User not found
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /users/{userId}/notifications:
    put:
      security:
        - bearerAuth: []
      tags:
        - user
      summary: Update user notification settings
      description: Update notification preferences for a specific user.
      operationId: updateUserNotificationsSettings
      parameters:
        - name: userId
          in: path
          description: The ID of the user
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/UpdateUserNotifications'
      responses:
        '204':
          description: Notification settings updated successfully
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ServerMetrics:
      type: array
      items:
        type: object
        properties:
          CPU:
            type: integer
            example: 2
          RAM:
            type: integer
            example: 22
          Disk:
            type: integer
            example: 43
          Date:
            type: string
            example: "2025-04-07"
        xml:
          name: serverMetric
      xml:
        name: serverMetrics

    UpdateUser:
      type: object
      properties:
        name:
          type: string
          example: Joe
        surname:
          type: string
          example: Doe
        email:
          type: string
          example: john@email.com
      xml:
        name: updateUser

    UpdateUserNotifications:
      type: object
      properties:
        discordNotifications:
          type: boolean
          example: true
        slackNotifications:
          type: boolean
          example: false
        emailNotifications:
          type: boolean
          example: false
      xml:
        name: updateUserNotifications

    CreateApp:
      type: object
      properties:
        name:
          type: string
          example: My app
        description:
          type: string
          example: Weather app
        ipAddress:
          type: string
          example: 192.168.0.100
        port:
          type: string
          example: 3020
        discordWebhook:
          type: string
          example: https://discord.com/api/webhooks/1234567890/abcdefghijklmnopqrstuvwxyz
        slackWebhook:
          type: string
          example: https://hooks.slack.com/services/1234567890/abcdefghijklmnopqrstuvwxyz
      xml:
        name: createApp

    UpdateApp:
      type: object
      properties:
        name:
          type: string
          example: My app
        description:
          type: string
          example: Weather app
        ipAddress:
          type: string
          example: 192.168.0.100
        port:
          type: string
          example: 3020
        discordWebhook:
          type: string
          example: https://discord.com/api/webhooks/1234567890/abcdefghijklmnopqrstuvwxyz
        slackWebhook:
          type: string
          example: https://hooks.slack.com/services/1234567890/abcdefghijklmnopqrstuvwxyz
      xml:
        name: updateApp

    StatusApp:
      type: object
      properties:
        appId:
          type: string
          example: d23jd9823hd239hd238d
        status:
          type: string
          example: running
        changedAt:
          type: string
          example: 2025-06-07 12:23:24
        duration:
          type: integer
          example: 23423
      xml:
        name: statusApp

    CreateUser:
      type: object
      properties:
        name:
          type: string
          example: Joe
        surname:
          type: string
          example: Doe
        email:
          type: string
          example: john@email.com
        password:
          type: string
          example: jzaq!2234RFv@
      xml:
        name: createUser

    LoginUser:
      type: object
      properties:
        email:
          type: string
          example: john@email.com
        password:
          type: string
          example: jzaq!2234RFv@
      xml:
        name: loginUser
    GetApps:
      type: array
      items:
        type: object
        properties:
          id:
            type: string
            example: 27cf4966c158762ceb9495fbdd044a73325efd3bd2a4f9646fc45662ef59490d
          name:
            type: string
            example: solar panels
          description:
            type: string
            example: test
          is_docker:
            type: boolean
            example: true
          owner_id:
            type: integer
            example: 12
          ip_address:
            type: string
            example: 192.168.0.100
          port:
            type: string
            example: 3020
          email_notifications:
            type: boolean
            example: true
          slack_webhook:
            type: string
            example: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX
          discord_webhook:
            type: string
            example: https://discord.com/api/webhooks/1234567890/abcdefghijklmnopqrstuvwxyz
        xml:
          name: getApps
    GetApp:
      type: object
      properties:
        id:
          type: string
          example: 27cf4966c158762ceb9495fbdd044a73325efd3bd2a4f9646fc45662ef59490d
        name:
          type: string
          example: solar panels
        description:
          type: string
          example: test
        is_docker:
          type: boolean
          example: true
        owner_id:
          type: integer
          example: 12
        ip_address:
          type: string
          example: 192.168.0.100
        port:
          type: string
          example: 3020
        email_notifications:
          type: boolean
          example: true
        slack_webhook:
          type: string
          example: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX
        discord_webhook:
          type: string
          example: https://discord.com/api/webhooks/1234567890/abcdefghijklmnopqrstuvwxyz
      xml:
        name: getApp
    GetUser:
      type: object
      properties:
        id:
          type: integer
          example: 23
        name:
          type: string
          example: Joe
        surname:
          type: string
          example: Doe
        email:
          type: string
          example: john@email.com
        password:
          type: string
          example: jzaq!2234RFv@
        discord_notifications:
          type: boolean
          example: false
        slack_notifications:
          type: boolean
          example: true
        email_notifications:
          type: boolean
          example: true
        created_at:
          type: string
          example: 2025-06-07 12:23:24
        updated_at:
          type: string
          example: 2025-06-07 12:23:24
      xml:
        name: getUser
    VerifyUser:
      type: object
      properties:
        userId:
          type: integer
          example: 23
      xml:
        name: verifyUser
    Token:
      type: object
      properties:
        token:
          type: string
          example: d23dj328dd32092823udd23423423423e32xr23rx23
      xml:
        name: token
    ServerInfo:
      type: object
      properties:
        model_name:
          type: string
          example: Intel I5
        ram_total:
          type: integer
          example: 32
        disk_total:
          type: integer
          example: 1000
        os:
          type: string
          example: Linux
        platform:
          type: string
          example: ArchLinux
        kernel_version:
          type: string
          example: 1.2.443
        uptime:
          type: integer
          example: 231213
      xml:
        name: serverInfo
    Error:
      type: object
      properties:
        errorCategory:
          type: string
        errorDescription:
          type: string
      required:
        - errorCategory
        - errorDescription
